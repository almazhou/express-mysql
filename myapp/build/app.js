var express=require("express"),path=require("path"),favicon=require("static-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),routes=require("./routes/index"),users=require("./routes/users"),products=require("./routes/products"),app=express();app.set("views",path.join(__dirname,"views")),app.set("view engine","jade"),app.use(favicon()),app.use(logger("dev")),app.use(bodyParser.json()),app.use(bodyParser.urlencoded()),app.use(cookieParser()),app.use(express.static(path.join(__dirname,"public"))),app.use("/",routes),app.use("/users",users),app.use("/products",products),app.use(function(e,r,s){var p=new Error("Not Found");p.status=404,s(p)}),"development"===app.get("env")&&app.use(function(e,r,s){s.status(e.status||500),s.render("error",{message:e.message,error:e})}),app.use(function(e,r,s){s.status(e.status||500),s.render("error",{message:e.message,error:{}})}),app.listen(3e3),module.exports=app;
mysql=require("mysql");var connection=mysql.createConnection({user:"root",password:""});connection.query("use express_mysql"),module.exports=connection;
var connection=require("../database/mysql");exports.save=function(e,n){connection.query("INSERT INTO orders SET ?",e,function(e,r){e?n(e):n(null,r)})},exports.findAllOrders=function(e,n){connection.query("SELECT * FROM orders where user_id = ?",e,function(e,r){e?n(e):n(null,r)})},exports.findOrderById=function(e,n,r){connection.query("SELECT * FROM orders where user_id = ? and id = ?",[e,n],function(e,n){e?r(e):r(null,n)})},exports.reset=function(){connection.query("truncate orders",function(e){console.log(e?"error reset table":"success reset table")})};
var connection=require("../database/mysql");exports.save=function(e,n){connection.query("INSERT INTO payment SET ?",e,function(e,t){e?n(e):n(null,t)})},exports.findAllPayment=function(e,n,t){connection.query("SELECT * FROM payment where user_id = ? and order_id = ?",[e,n],function(e,n){e?t(e):t(null,n)})},exports.reset=function(){connection.query("truncate payment",function(e){console.log(e?"error reset table":"success reset table")})};
var connection=require("../database/mysql");exports.save=function(n,e){connection.query("INSERT INTO pricing SET ?",n,function(n,i){n?e(n):e(null,i)})},exports.findAllPricings=function(n,e){connection.query("SELECT * FROM pricing where product_id = ?",n,function(n,i){n?e(n):e(null,i)})},exports.findPricingById=function(n,e,i){console.log("I am here now in find all pricing by id"),connection.query("SELECT * FROM pricing where product_id = ? and id = ?",[n,e],function(n,e){n?i(n):i(null,e)})},exports.reset=function(){connection.query("truncate pricing",function(n){console.log(n?"error reset table":"success reset table")})};
var connection=require("../database/mysql");exports.save=function(n,e){connection.query("INSERT INTO product SET ?",n,function(n,o){n?e(n):e(null,o)})},exports.all=function(n){connection.query("SELECT * FROM product",function(e,o){e?n(e):n(null,o)})},exports.findById=function(n,e){connection.query("SELECT * FROM product where id = ?",n,function(n,o){return n?e(n):e(null,o)})},exports.reset=function(){connection.query("truncate product",function(n){console.log(n?"error reset table":"success reset table")})};
var express=require("express"),router=express.Router();router.get("/",function(e,r){r.render("index",{title:"Express"})}),module.exports=router;
var express=require("express"),Product=require("../model/product"),Pricing=require("../model/pricing"),router=express.Router();router.get("/",function(r,i){Product.all(function(r,n){var t=n.map(function(r){return{uri:"/products/"+r.id,id:r.id,name:r.name,current_price:r.price}});return i.send(r?500:t)})}),router.post("/",function(r,i){var n={name:r.body.name,price:r.body.price};Product.save(n,function(r,n){return r?i.send(500):(i.location("/products/"+n.insertId),i.send(201))})}),router.get("/:id",function(r,i){Product.findById(r.params.id,function(r,n){var t=n.map(function(r){return{uri:"/products/"+r.id,id:r.id,name:r.name,current_price:r.price}});return i.send(r?500:0===n.length?404:t)})}),router.get("/:id/pricings",function(r,i){Pricing.findAllPricings(r.params.id,function(r,n){var t=n.map(function(r){return{uri:"/products/"+r.product_id+"/pricings/"+r.id,id:r.id,product_id:r.product_id,amount:r.amount}});return i.send(r?500:0===n.length?404:t)})}),router.post("/:id/pricings",function(r,i){var n={amount:r.body.amount,product_id:r.params.id};Pricing.save(n,function(r,n){return r?void 0:(i.location("/products/1/pricings/"+n.insertId),i.send(201))})}),router.get("/:product_id/pricings/:pricing_id",function(r,i){Pricing.findPricingById(r.params.product_id,r.params.pricing_id,function(r,n){var t=n.map(function(r){return{uri:"/products/"+r.product_id+"/pricings/"+r.id,id:r.id,product_id:r.product_id,amount:r.amount}});return i.send(r?500:0===n.length?404:t)})}),module.exports=router;
var express=require("express"),Order=require("../model/order"),Payment=require("../model/payment"),router=express.Router();router.get("/:id/orders",function(r,e){Order.findAllOrders(r.params.id,function(r,d){var t=d.map(function(r){return{uri:"/users/"+r.user_id+"/orders/"+r.id,total_cost:r.total_cost,user_id:r.user_id,date:r.date}});return e.send(r?500:0===d.length?404:t)})}),router.get("/:user_id/orders/:order_id/payment",function(r,e){Payment.findAllPayment(r.params.user_id,r.params.order_id,function(r,d){var t=d.map(function(r){return{uri:"/users/"+r.user_id+"/orders/"+r.order_id+"/payment",amount:r.amount,user_id:r.user_id,order_id:r.order_id,date:r.date}});return e.send(r?500:0===d.length?404:t)})}),router.post("/:user_id/orders/:order_id/payment",function(r,e){var d={user_id:r.params.user_id,order_id:r.params.order_id,amount:r.body.amount};Payment.save(d,function(d){return d?void 0:(e.location("/users/"+r.params.user_id+"/orders/"+r.params.order_id+"/payment"),e.send(201))})}),router.post("/:id/orders",function(r,e){var d={total_cost:r.body.total_cost,user_id:r.params.id};Order.save(d,function(d,t){return d?void 0:(e.location("/users/"+r.params.id+"/orders/"+t.insertId),e.send(201))})}),router.get("/:user_id/orders/:order_id",function(r,e){Order.findOrderById(r.params.user_id,r.params.order_id,function(r,d){var t=d.map(function(r){return{uri:"/users/"+r.user_id+"/orders/"+r.id,total_cost:r.total_cost,user_id:r.user_id,date:r.date}});return e.send(r?500:0===d.length?404:t)})}),module.exports=router;